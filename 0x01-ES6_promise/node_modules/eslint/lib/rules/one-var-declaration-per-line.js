/**
 * @fileoverview Rule to check multiple var declarations per line
 * @author Alberto Rodr√≠guez
 */
"use strict";

//------------------------------------------------------------------------------
// Rule Definition
//------------------------------------------------------------------------------

<<<<<<< HEAD
=======
/** @type {import('../shared/types').Rule} */
>>>>>>> 2ddce255cccd5c3f5dc8c68e12add2eef5d3e217
module.exports = {
    meta: {
        type: "suggestion",

        docs: {
<<<<<<< HEAD
            description: "require or disallow newlines around variable declarations",
            category: "Stylistic Issues",
            recommended: false,
            url: "https://eslint.org/docs/rules/one-var-declaration-per-line"
=======
            description: "Require or disallow newlines around variable declarations",
            recommended: false,
            url: "https://eslint.org/docs/latest/rules/one-var-declaration-per-line"
>>>>>>> 2ddce255cccd5c3f5dc8c68e12add2eef5d3e217
        },

        schema: [
            {
                enum: ["always", "initializations"]
            }
        ],

<<<<<<< HEAD
        fixable: "whitespace"
=======
        fixable: "whitespace",

        messages: {
            expectVarOnNewline: "Expected variable declaration to be on a new line."
        }
>>>>>>> 2ddce255cccd5c3f5dc8c68e12add2eef5d3e217
    },

    create(context) {

<<<<<<< HEAD
        const ERROR_MESSAGE = "Expected variable declaration to be on a new line.";
=======
>>>>>>> 2ddce255cccd5c3f5dc8c68e12add2eef5d3e217
        const always = context.options[0] === "always";

        //--------------------------------------------------------------------------
        // Helpers
        //--------------------------------------------------------------------------


        /**
         * Determine if provided keyword is a variant of for specifiers
         * @private
         * @param {string} keyword keyword to test
         * @returns {boolean} True if `keyword` is a variant of for specifier
         */
        function isForTypeSpecifier(keyword) {
            return keyword === "ForStatement" || keyword === "ForInStatement" || keyword === "ForOfStatement";
        }

        /**
         * Checks newlines around variable declarations.
         * @private
         * @param {ASTNode} node `VariableDeclaration` node to test
         * @returns {void}
         */
        function checkForNewLine(node) {
            if (isForTypeSpecifier(node.parent.type)) {
                return;
            }

            const declarations = node.declarations;
            let prev;

            declarations.forEach(current => {
                if (prev && prev.loc.end.line === current.loc.start.line) {
                    if (always || prev.init || current.init) {
                        context.report({
                            node,
<<<<<<< HEAD
                            message: ERROR_MESSAGE,
                            loc: current.loc.start,
=======
                            messageId: "expectVarOnNewline",
                            loc: current.loc,
>>>>>>> 2ddce255cccd5c3f5dc8c68e12add2eef5d3e217
                            fix: fixer => fixer.insertTextBefore(current, "\n")
                        });
                    }
                }
                prev = current;
            });
        }

        //--------------------------------------------------------------------------
        // Public
        //--------------------------------------------------------------------------

        return {
            VariableDeclaration: checkForNewLine
        };

    }
};
